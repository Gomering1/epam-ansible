---
- name: create_users
  hosts: test_servers
  become: yes

  tasks:
  - name: create_user
    user:
      name: "{{ item.name }}"
      state: present
      comment: "{{ item.name }}@example.com"
      home: "/home/{{ item.name }}"
      password: "{{ '{{ item.pass}}' | password_hash('sha512') }}"
      update_password: always
      groups: "adm"
      password_lock: False
      uid: "{{ item.uid }}"
    loop:
      - name: Alice
        uid: 1534
        pass: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          37653961353034353037643130393963326338336337633334363236643734646331326665376266
          6261383365663966383439363335323138396330636538340a643733356530363336373438373861
          33633835326634613261386462646636326337306133396438383266303934353037643461363661
          3937303833313230620a343730626430393535366533366137373764643734393861383461313730
          3037
      - name: Bob
        uid: 1535
        pass: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          63323838633264393632393435633939643734306366613836386638383163396431306632366163
          3635383933623262343531653264636234653666333630360a666263343333376634356232633034
          61326565653336353166336433623135396365323466623566313030336435316632336666353336
          3939386462666662660a333234323537386665353962643764366531656536343562393232666662
          3838
      - name: Carol
        uid: 1536
        pass: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          36383866633064633830326366356266326664363838383639313030636465323263306265343636
          3761306364623064366262626632373838356130366232630a666563376663346534366235613531
          37386561336461353961306139623965323139303836663865313830633163313337626563396639
          6235323665393437370a356538623931333336393832353065316530653065356364643239643838
          6462

